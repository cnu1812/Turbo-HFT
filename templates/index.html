<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Turbo-HFT // KERNEL ACCESS</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/4.0.1/socket.io.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Share+Tech+Mono&display=swap" rel="stylesheet">

    <style>
        :root {
            --bg-color: #050505;
            --card-bg: rgba(20, 25, 40, 0.7);
            --neon-blue: #00f3ff;
            --neon-green: #00ff41;
            --neon-red: #ff0055;
            --neon-gold: #ffd700;
            --border-color: rgba(0, 243, 255, 0.2);
        }

        body {
            background-color: var(--bg-color);
            background-image: radial-gradient(circle at 50% 50%, #111520 0%, #050505 100%);
            color: #e0e0e0;
            font-family: 'Share Tech Mono', monospace;
            overflow-x: hidden;
        }

        /* Glitchy Header Effect */
        h1 {
            text-shadow: 2px 2px 0px var(--neon-red), -2px -2px 0px var(--neon-blue);
            letter-spacing: 2px;
        }

        /* Glassmorphism Cards */
        .cyber-card {
            background: var(--card-bg);
            border: 1px solid var(--border-color);
            backdrop-filter: blur(10px);
            border-radius: 4px;
            box-shadow: 0 0 15px rgba(0, 243, 255, 0.05);
            transition: all 0.3s ease;
        }
        
        .cyber-card:hover {
            box-shadow: 0 0 20px rgba(0, 243, 255, 0.2);
            border-color: var(--neon-blue);
        }

        .card-title {
            color: var(--neon-blue);
            font-size: 0.9em;
            text-transform: uppercase;
            letter-spacing: 1px;
            opacity: 0.8;
            margin-bottom: 5px;
        }

        .stat-val {
            font-size: 2.2em;
            text-shadow: 0 0 10px rgba(255, 255, 255, 0.3);
        }

        /* Specific Colors */
        .text-gold { color: var(--neon-gold) !important; text-shadow: 0 0 10px rgba(255, 215, 0, 0.5); }
        .text-green { color: var(--neon-green) !important; text-shadow: 0 0 10px rgba(0, 255, 65, 0.5); }
        .text-red { color: var(--neon-red) !important; text-shadow: 0 0 10px rgba(255, 0, 85, 0.5); }
        .text-blue { color: var(--neon-blue) !important; }

        /* Buttons */
        .btn-cyber {
            background: transparent;
            border: 1px solid var(--neon-blue);
            color: var(--neon-blue);
            text-transform: uppercase;
            letter-spacing: 2px;
            transition: 0.2s;
        }
        .btn-cyber:hover {
            background: var(--neon-blue);
            color: #000;
            box-shadow: 0 0 15px var(--neon-blue);
        }

        .btn-kill {
            border-color: var(--neon-red);
            color: var(--neon-red);
        }
        .btn-kill:hover {
            background: var(--neon-red);
            color: white;
            box-shadow: 0 0 20px var(--neon-red);
        }

        .btn-sell {
            background: rgba(0, 255, 65, 0.1);
            border: 1px solid var(--neon-green);
            color: var(--neon-green);
            font-size: 1.2em;
            height: 100%;
        }
        .btn-sell:hover {
            background: var(--neon-green);
            color: black;
            box-shadow: 0 0 25px var(--neon-green);
        }

        /* Terminal Log */
        .terminal-window {
            height: 200px;
            background: #000;
            border: 1px solid #333;
            padding: 10px;
            font-family: 'Courier New', monospace;
            font-size: 0.8em;
            color: #0f0;
            overflow-y: scroll;
            box-shadow: inset 0 0 10px #000;
        }
        .log-entry { margin-bottom: 2px; border-bottom: 1px solid #111; }
        .log-time { color: #555; margin-right: 10px; }

        /* Pulse Animation for Status */
        @keyframes pulse-green {
            0% { box-shadow: 0 0 0 0 rgba(0, 255, 65, 0.7); }
            70% { box-shadow: 0 0 0 10px rgba(0, 255, 65, 0); }
            100% { box-shadow: 0 0 0 0 rgba(0, 255, 65, 0); }
        }
        .status-online {
            animation: pulse-green 2s infinite;
            background-color: var(--neon-green);
            color: black;
            border: none;
        }
    </style>
</head>
<body class="container-fluid py-4 px-4">
    
    <div class="row mb-4 align-items-center">
        <div class="col-md-6">
            <h1>TURBO-HFT <span style="font-size:0.4em; color:var(--neon-blue)">v3.0 // XDP ENGINE</span></h1>
        </div>
        <div class="col-md-6 text-end">
            <span id="status-badge" class="badge bg-secondary p-2" style="font-size: 1em;">INITIALIZING UPLINK...</span>
        </div>
    </div>

    <div class="row g-4 mb-4">
        <div class="col-md-3">
            <div class="cyber-card p-3">
                <div class="card-title">Shares Held</div>
                <div class="stat-val text-gold" id="shares">0</div>
            </div>
        </div>
        <div class="col-md-3">
            <div class="cyber-card p-3">
                <div class="card-title">Current Exposure</div>
                <div class="stat-val text-blue" id="spent">$0.00</div>
            </div>
        </div>
        <div class="col-md-3">
            <div class="cyber-card p-3">
                <div class="card-title">Algo Target</div>
                <div class="stat-val text-white" id="target">$0.00</div>
            </div>
        </div>
        <div class="col-md-3">
            <div class="cyber-card p-3">
                <div class="card-title">Realized Profit</div>
                <div class="stat-val text-green" id="bank">$0.00</div>
            </div>
        </div>
    </div>

    <div class="row g-4">
        
        <div class="col-md-3">
            <div class="cyber-card p-3 h-100">
                <h5 class="text-blue mb-4">COMMAND MODULE</h5>
                
                <label class="text-muted mb-2">RISK TOLERANCE</label>
                <div class="d-grid gap-3 mb-4">
                    <button class="btn btn-cyber py-3" onclick="setPrice(148)">
                        LEVEL 1: $148.00
                    </button>
                    <button class="btn btn-cyber py-3" onclick="setPrice(155)">
                        LEVEL 2: $155.00
                    </button>
                </div>

                <label class="text-muted mb-2">LIQUIDATION</label>
                <div class="d-grid gap-3 mb-4">
                    <button class="btn btn-sell py-3" onclick="sellAll()">
                        CASH OUT
                    </button>
                </div>

                <hr style="border-color: #333">
                
                <button class="btn btn-kill w-100 py-3 mt-2" onclick="killSwitch()">
                    ⛔ EMERGENCY STOP
                </button>
            </div>
        </div>

        <div class="col-md-6">
            <div class="cyber-card p-3 h-100">
                <h5 class="text-blue mb-3">LATENCY & VOLUME ANALYTICS</h5>
                <canvas id="liveChart" style="max-height: 350px;"></canvas>
            </div>
        </div>

        <div class="col-md-3">
            <div class="cyber-card p-3 h-100">
                <h5 class="text-blue mb-3">KERNEL EVENT LOG</h5>
                <div id="terminal" class="terminal-window">
                    <div class="log-entry"><span class="log-time">sys</span> System Ready...</div>
                    <div class="log-entry"><span class="log-time">sys</span> XDP Hook Attached.</div>
                    <div class="log-entry"><span class="log-time">sys</span> Waiting for market data...</div>
                </div>
            </div>
        </div>
    </div>

    <script>
        var socket = io({transports: ['websocket', 'polling']});
        
        // --- 1. SETUP CHART ---
        const ctx = document.getElementById('liveChart').getContext('2d');
        const liveChart = new Chart(ctx, {
            type: 'line',
            data: {
                labels: Array(20).fill(''),
                datasets: [{
                    label: 'Portfolio Size',
                    data: Array(20).fill(0),
                    borderColor: '#00f3ff',
                    backgroundColor: 'rgba(0, 243, 255, 0.1)',
                    borderWidth: 2,
                    tension: 0.4,
                    fill: true,
                    pointRadius: 0
                }]
            },
            options: {
                responsive: true,
                plugins: { legend: { display: false } },
                scales: {
                    y: { 
                        grid: { color: '#222' },
                        ticks: { color: '#666' } 
                    },
                    x: { display: false }
                },
                animation: false
            }
        });

        // --- 2. TERMINAL LOGIC ---
        function log(msg, type="info") {
            const term = document.getElementById('terminal');
            const div = document.createElement('div');
            div.className = "log-entry";
            
            const time = new Date().toLocaleTimeString().split(' ')[0];
            let color = "#0f0";
            if(type === 'buy') color = "var(--neon-gold)";
            if(type === 'err') color = "var(--neon-red)";
            
            div.innerHTML = `<span class="log-time">${time}</span> <span style="color:${color}">${msg}</span>`;
            term.appendChild(div);
            term.scrollTop = term.scrollHeight; // Auto scroll
        }

        // --- 3. SOCKET UPDATES ---
        let lastShares = 0;

        socket.on('connect', function() {
            log("Connected to Control Plane", "info");
            document.getElementById('status-badge').innerHTML = "UPLINK ESTABLISHED";
        });

        socket.on('stats_update', function(data) {

            // --- RECEIPT PRINTER ---
        socket.on('trade_receipt', function(data) {
            const fmt = new Intl.NumberFormat('en-US', { style: 'currency', currency: 'USD' });
            
            // Force open the visual log with style
            log("------------------------------", "info");
            log(">>> EXECUTING LIQUIDATION <<<", "buy");
            log(`[>] SHARES SOLD:   ${data.shares}`, "info");
            log(`[>] EXECUTION PR:  ${fmt.format(data.exec_price)}`, "info");
            log(`[>] TOTAL REVENUE: ${fmt.format(data.revenue)}`, "info");
            log(`[>] CAPITAL SPENT: ${fmt.format(data.cost)}`, "err"); 
            log("------------------------------", "info");
            
            // The BIG Profit Line
            log(`[=] NET PROFIT:    ${fmt.format(data.profit)}`, "buy");
            log("------------------------------", "info");
            
           
        });
            // Update Text
            document.getElementById('shares').innerText = data.shares;
            
            const fmt = new Intl.NumberFormat('en-US', { style: 'currency', currency: 'USD' });
            document.getElementById('spent').innerText = fmt.format(data.spent);
            document.getElementById('target').innerText = fmt.format(data.target);
            document.getElementById('bank').innerText = fmt.format(data.bank);

            // Status Logic
            const badge = document.getElementById('status-badge');
            if(data.status == 1) {
                badge.className = "badge p-2 status-online";
                badge.innerHTML = "● SYSTEM ONLINE";
            } else {
                badge.className = "badge bg-danger p-2";
                badge.innerHTML = "⚠ SAFETY MODE";
            }

            // Update Chart
            const currentData = liveChart.data.datasets[0].data;
            currentData.shift(); // Remove old
            currentData.push(data.shares); // Add new
            liveChart.update();

            // Fake "Trade" Logs if shares increased
            if (data.shares > lastShares) {
                const diff = data.shares - lastShares;
                log(`XDP_TX: BUY EXEC ${diff} @ MKT`, "buy");
            }
            lastShares = data.shares;
        });

        // --- 4. BUTTONS ---
        function setPrice(price) { 
            socket.emit('set_price', {price: price}); 
            log(`CMD: UPDATING ALGO TARGET -> $${price}`, "info");
        }
        function killSwitch() { 
            socket.emit('kill_switch'); 
            log("CMD: EMERGENCY STOP TRIGGERED", "err");
        }
        function sellAll() { 
            socket.emit('sell_all'); 
            log("CMD: LIQUIDATING ALL ASSETS...", "info");
        }
    </script>
</body>
</html>
